# Telegram Broadcast Automation

**Комплексное решение для управления массовыми рассылками в Telegram‑каналах.**  
Проект объединяет Telegram‑бота, веб‑панель и планировщик, позволяя:

- Легко добавлять и удалять целевые каналы через бот или веб‑интерфейс.  
- Писать и форматировать текст в WYSIWYG‑редакторе Quill, включая списки, ссылки и код.  
- Прикреплять одну картинку к каждому посту.  
- Планировать публикации с точностью до минуты.  
- Надёжно отправлять отложенные посты через Telethon с поддержкой HTML‑разметки.

---

## Описание компонентов

1. **Aiogram‑бот**  
   - Обрабатывает команды администратора:  
     - `/addchannel <chat_id> [название]` — добавить новый канал  
     - `/deletechannel <chat_id>` — удалить канал  
     - `/list` — вывести список каналов  
     - `/post` — отправить заранее подготовленный текст из папки `posts/`

2. **Веб‑панель (FastAPI + Jinja2)**  
   - Доступна по адресу `http://localhost:8080`  
   - Раздел «Каналы»: просмотр, добавление, удаление  
   - Раздел «Запланировать пост»:  
     - WYSIWYG‑редактор Quill  
     - Поле для выбора даты и времени публикации  
     - Загрузка одного изображения  
     - Кнопка «Запланировать» сохраняет задачу в очередь  

3. **APScheduler**  
   - Хранит отложенные публикации в JSON-файле  
   - Каждую минуту проверяет очередь и запускает отправку, если пришло время  
   - После успешной отправки удаляет задачу из файла  

4. **Telethon**  
   - Подключается к Telegram‑API от имени вашего бота или пользователя  
   - Отправляет текст с `parse_mode="html"` и прикрепляет изображение  

---

## Структура (кратко)

- **`bot.py`**, **`dispatcher.py`** — логика бота и мгновенной отправки  
- **`web/main.py`**, **`web/templates/index.html`** — веб‑интерфейс управления  
- **`scheduler.py`** — планировщик задач  
- **`config.py`** — конфигурация через переменные окружения  
- **`posts/`** — папка с текстовыми шаблонами для ручной отправки  
- **`scheduled_posts.json`** — очередь отложенных публикаций  

---

## Установка и запуск

1. Склонируйте репозиторий и перейдите в него:
   ```bash
   git clone https://github.com/k2wGG/Telegram-Broadcast-Automation.git
   cd Telegram-Broadcast-Automation
   ```

2. Создайте виртуальное окружение и активируйте:

   ```bash
   python -m venv venv
   # macOS/Linux
   source venv/bin/activate
   # Windows
   venv\Scripts\activate
   ```

3. Установите зависимости:

   ```bash
   pip install -r requirements.txt
   ```

4. Создайте файл `.env` в корне и задайте:

   ```ini
   BOT_TOKEN=<ваш токен бота>
   API_ID=<ваш api_id>
   API_HASH=<ваш api_hash>
   POSTS_FOLDER=posts
   ```

5. Запустите весь стек одной командой:

   ```bash
   python main.py
   ```

---

## Использование

* **Веб‑панель**:

  1. Откройте в браузере `http://localhost:8080`.
  2. Добавьте каналы и запланируйте публикацию в удобном редакторе.

* **Через бота**:

  1. Отправьте `/start` — получите справку.
  2. Командами `/addchannel`, `/list`, `/deletechannel`, `/post` управляйте каналами и отправкой.

Отложенные публикации отправляются автоматически в указанное время.

---

## Лицензия

Этот проект распространяется под лицензией **MIT**.
